* Overview 

Elisp ressource: [[https://www.gnu.org/software/emacs/manual/html_mono/eintr.html][introduction to elisp]]
Emacs wiki: ???

ESS and elpy are pretty slow, consider removing or alternatives -> just have the
snippets (yasnippets), syntax check (flycheck) and lsp (company + eglot)

** TODO Customization

Simplified custom essentials for increased efficiency of text file editing.
- C-; (prefix for custom commands)
  
Additional packages
- Projectile (project management)
- Company (autocomplete)
- Yasnippets (duh)
- Flycheck (ok)
- Dash (for documentations)
- Man (man pages, do I have this already?)
- Tags (code navigations)
- Snipe (bc evil is not really emacs-y...)
- Gud (debugging)
- Which-key (keybindings cheatsheet)
- Ivy
- ace-window
- ace-jump

Essentials:
1. multi-line editing (http://ergoemacs.org/emacs/emacs_string-rectangle_ascii-art.html)
2. eshell (learn more, efficiency, and configuration)
   - aliases
   - prompt customization
   - shortcuts
   - integration with dired (for improved movement and file management)
   - quick minibuffer command binding
3. build commands for cpp

Misc:
- Major mode for scientific publication search, bib and paper download
  (look at behavior similar to rss feed reader: list of articles above,
  display article abstract + bibtex in window below)
- Backup manager
- Splash screen (dashboard)
- statusbar/modeline

** Cheat Sheet
*** Window navigation
*** Navigation

-n down
-p up
-f forward
-b backwards
-f forward word
-b backward word
-a beginning line
-e end line
-a beginning sentence/paragraph
-e end sentence/paragraph
-< top of buffer
-> end of buffer

*** Deletion

-d delete char forward
-DEL delete char backward
-d delete word forward

-DEL delete word backward
-k delete to end of line
-S-DEL delete line
-SPC set mark
-w delete + copy selection
-w copy selection
-y paste (yank)

*** Insertion
 substitute word
 substitute in selection
 substitute in file

*** Misc
-/ undo
-l center/top cursor to screen
-r toggle cursor top middle bottom screen

*** Dired
C-x d open dired from input directory
 d to mark as delete
 x to execute action

*** Orgmode
-RET new header same level
-S-RET new header TODO same level

or lists:
-c C-c toggle checkbox

*** Search
-s i-search
-M-s regxp search
-% search + replace
-S-% search + replace regexp

*** Magit
M-x magit to open the menu
- s to stage changes (<shift> for all)
  - Tab to inspect items
  - RET to got to files
- c to commit changes
  - write message then C-c C-c to exit
- p to push changes

* packages setup

The use-package way of installing and using packages for emacs [[https://jwiegley.github.io/use-package/][homepage]]
Install packages and lazy-load with use-package for better performance and
easily setting options on startup.

#+BEGIN_SRC emacs-lisp
(require 'package)
(let* ((no-ssl (and (memq system-type '(windows-nt ms-dos))
                    (not (gnutls-available-p))))
       (proto (if no-ssl "http" "https")))
  (when no-ssl (warn "\
Your version of Emacs does not support SSL connections,
which is unsafe because it allows man-in-the-middle attacks.
There are two things you can do about this warning:
1. Install an Emacs version that does support SSL and be safe.
2. Remove this warning from your init file so you won't see it again."))
  (add-to-list 'package-archives (cons "melpa" (concat proto "://melpa.org/packages/")) t)
  ;; Comment/uncomment this line to enable MELPA Stable if desired.  See `package-archive-priorities`
  ;; and `package-pinned-packages`. Most users will not need or want to do this.
  ;;(add-to-list 'package-archives (cons "melpa-stable" (concat proto "://stable.melpa.org/packages/")) t)
  )
(package-initialize)
(setq package-archives '(("gnu" . "https://elpa.gnu.org/packages/")
                         ("melpa" . "https://melpa.org/packages/")))
(setq package-check-signature 'allow-unsigned)

;; now for use-package
(add-to-list 'load-path "~/.emacs.d/site-lisp/use-package")
(require 'use-package)

(with-eval-after-load 'info
  (info-initialize)
  (add-to-list 'Info-directory-list
               "~/.emacs.d/site-lisp/use-package/"))
#+END_SRC

* appearance

- colorscheme
- status line
- bars
- font
- line numbers
- startup prompt

#+BEGIN_SRC emacs-lisp
;; best themes 
(use-package base16-theme
  :ensure t
  :config
  (load-theme 'base16-dracula t))

;; This status line is not great, improve on clarity of information displayed.
(display-time-mode 1)

;; highlight current line
(global-hl-line-mode 1)

;; disable all GUI bars
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)

;; dope bitmap font
(set-frame-font "Spleen 32x64 14" nil t)

;; does not display line numbers by default
;; toggle with keybinding C-= l
(global-linum-mode 1)
(global-set-key (kbd "C-; l") 'global-linum-mode)

;; on startup -> currently nothing goes to scratch
;; TODO make improvements to this
(setq inhibit-startup-screen t)
#+END_SRC

* backup

Relocate temporary files and backups from emacs

#+BEGIN_SRC emacs-lisp
;; Place backup files in a specific folder, this was copy-pasted...
;; Should be rewritten and customized
;;Put backup files neatly away
(let ((backup-dir "~/.emacs.d/Emacs/backups")
      (auto-saves-dir "~/.emacs.d/Emacs/autosavedir/")
      )
  (dolist (dir (list backup-dir auto-saves-dir))
    (when (not (file-directory-p dir))
      (make-directory dir t)))
  (setq backup-directory-alist `(("." . ,backup-dir))
        auto-save-file-name-transforms `((".*" ,auto-saves-dir))
        auto-save-list-file-prefix (concat auto-saves-dir ".saves-")
        tramp-backup-directory-alist `((".*" . ,backup-dir))
        tramp-auto-save-directory auto-saves-dir
        )
  )
(setq backup-by-copying t    ; Don't delink hardlinks
      delete-old-versions t  ; Clean up the backups
      version-control t      ; Use version numbers on backups,
      kept-new-versions 3    ; keep some new versions
      kept-old-versions 2)   ; and some old ones, too
#+END_SRC

* buffer

Using ivy to manage minibuffer/buffer easily
(documentation: https://oremacs.com/swiper/)

TODO:
- favorite file menu
- setup file search w/ ripgrep/fzf?

#+BEGIN_SRC emacs-lisp
;; maybe put this as use-package for future?
(ivy-mode 1) ;;enables ivy
;; some standards settings to begin with
(setq ivy-use-virtual-buffers t)
(setq ivy-count-format "(%d/%d) ")

;; some more default settings to get started
(global-set-key (kbd "C-s") 'swiper-isearch)
(global-set-key (kbd "M-x") 'counsel-M-x)
(global-set-key (kbd "C-x C-f") 'counsel-find-file)
(global-set-key (kbd "M-y") 'counsel-yank-pop) ;;shows the kill ring

;; get help
(global-set-key (kbd "<f1> f") 'counsel-describe-function)
(global-set-key (kbd "<f1> v") 'counsel-describe-variable)
(global-set-key (kbd "<f1> l") 'counsel-find-library)

;; for emacs settings?
(global-set-key (kbd "<f2> i") 'counsel-info-lookup-symbol)
(global-set-key (kbd "<f2> u") 'counsel-unicode-char)
(global-set-key (kbd "<f2> j") 'counsel-set-variable)

(global-set-key (kbd "C-x b") 'ivy-switch-buffer)
(global-set-key (kbd "C-c v") 'ivy-push-view) ;;? do really get what this does...
(global-set-key (kbd "C-c V") 'ivy-pop-view)

;; some other kbd
(global-set-key (kbd "C-; n") 'new-frame)
(global-set-key (kbd "C-; c") 'delete-frame)
(global-set-key (kbd "C-; g") 'magit)
(global-set-key (kbd "C-; m") 'counsel-rhythmbox)
(global-set-key (kbd "C-; M") 'counsel-rhythmbox-playpause-current-song)
#+END_SRC

* editing

customized mode for editing based on simplicity
fast movement adapted to the file type and their regions of interest (ROI)
org -> headers or other ROI (code block, links, etc.)
python -> class, methods, import block
R -> funtions

Currently implemented:
- C-[ d delete word under cursor
- C-[ D delete line under cursor
- M-n next paragraph
- M-p previous paragraph

#+BEGIN_SRC emacs-lisp
;; bindings for easier paragraph movement
(global-set-key (kbd "M-p") 'backward-paragraph)
(global-set-key (kbd "M-n") 'forward-paragraph)
;; (load "~/.emacs.d/mr-editing.el")

;; Indent with of four and use tab to allow indentation
;; use M-i to insert tab
(setq-default tab-width 4
	indent-tabs-mode t)

;; Will highlight text in red if goes past 80 characters.
;; (does not work on startup ...)
(use-package column-enforce-mode
  :ensure t
  :init)
(setq-default global-column-enforce-mode t)

;; Autrowrap 80
;; still not working well, also does not matter all that much anyways (just use a
;; linter to fix inconsistencies)
(add-hook 'text-mode-hook 'turn-on-auto-fill)
(add-hook 'prog-mode-hook 'turn-on-auto-fill)
(add-hook 'org-mode-hook 'turn-on-auto-fill)
(setq-default fill-column 80)
(setq auto-fill-mode t)
#+END_SRC

* dired

- [ ] navigation without creating new buffers
- [ ] opening files with xdg-open

#+BEGIN_SRC emacs-lisp
(setq dired-listing-switches "-al --group-directories-first")
#+END_SRC

* TODO eshell

overview of the eshell: http://howardism.org/Technical/Emacs/eshell-present.html

configuration of the eshell:
- aliases
- prompt
- xdg-open for various files
- dired integrations

#+BEGIN_SRC emacs-lisp
;; minibuffer command
(global-set-key (kbd "C-; e") 'eshell)
(global-set-key (kbd "C-; M-e") 'eshell-command)
;; todo make the output of the command open in a new frame
(defun mkrun ()
	"execute make run command in eshell"
	(interactive)
	(with-selected-frame (make-frame)
		(eshell-command "make run")))
(setq eshell-prompt-function
	(lambda nil
		(concat 
			(propertize "[")
			(propertize (eshell/whoami))
			(propertize "@")
			(propertize (eshell/pwd))
			(propertize "]")
			(propertize "\n")
			(propertize "> "))))
(global-set-key (kbd "C-; r") 'mkrun)
#+END_SRC

* git

#+BEGIN_SRC emacs-lisp
(use-package magit
  :ensure t
  :init)
#+END_SRC

* TODO programming

The essentials I need for every language:
- code snippets
- syntax checking
- autocompletion + lsp
- goto function definition / variable declaration

TODO -> remove language specific packages (i.e. elpy ESS) since I barely use any
of their features...


#+BEGIN_SRC emacs-lisp
;; Enable yasnippets for all modes
(use-package yasnippet
  :ensure t
  :init
    (yas-global-mode 1))

;; Syntax checking for all modes
(use-package flycheck
  :ensure t
  :init
    (global-flycheck-mode t))

;; setup company mode
(require 'company)
(add-hook 'after-init-hook 'global-company-mode)
;; setup eglot ++++++++++++++++++
(use-package eglot :ensure t)
;; R
;; C++
(add-to-list 'eglot-server-programs '((c++-mode c-mode) "clangd-10"))
(add-hook 'c-mode-hook 'eglot-ensure)
(add-hook 'c++-mode-hook 'eglot-ensure)
(setq company-backends (delete 'company-semantic company-backends))
(define-key c-mode-map  [(tab)] 'company-complete)
(define-key c++-mode-map  [(tab)] 'company-complete)
;; python
(add-hook 'python-mode-hook 'eglot-ensure)

;; add markdown syntax support for emacs
(use-package markdown-mode
  :ensure t
  :mode (("README\\.md\\'" . gfm-mode)
         ("\\.md\\'" . markdown-mode)
         ("\\.markdown\\'" . markdown-mode))
  :init (setq markdown-command "multimarkdown"))
#+END_SRC

** python

 #+BEGIN_SRC emacs-lisp
 ;; Elpy package setup with use-package, using defer t
 ;; to enable lazy loading.

 (use-package elpy
   :ensure t
   :defer t
   :init
   (advice-add 'python-mode :before 'elpy-enable))
 (setq elpy-rpc-virtualenv-path 'current)
 (setq elpy-rpc-python-command "python3")
 (setq elpy-interactive-python-command "python3")
 #+END_SRC

** R

 #+BEGIN_SRC emacs-lisp
 ;; Powerful emacs speaks statistics package
 (use-package ess
  :ensure t
  :init (require 'ess-site))
 #+END_SRC
